<html>
<head>
	<title>Projeto-Video</title>
<style>
	@font-face {
		font-family: "Whitney";
		font-style: normal;
		text-rendering: optimizeLegibility;
		src: local("Whitney Medium"), url("whitneymedium.woff") format("woff");
	}

	* {
		user-select: none;
		font-size: 18px;
		font-family: Whitney;
		transition-duration: 0.25s;
		animation-duration: 0.25s;
		box-sizing: border-box;
	}

	@keyframes press {
		from {
			transform: none;
		}
		to {
			transform: scale(0.95);
		}
	}

	::-webkit-scrollbar {
		width: 0.5em;
		height: 0.5em;
		background: #181818;
	}
	::-webkit-scrollbar-thumb {
		transition-duration: 0.25s;
		background: #353535;
	}
	::-webkit-scrollbar-thumb:hover, ::-webkit-scrollbar-thumb:focus {
		transition-duration: 0.25s;
		background: #808080;
	}

	html, body {
		max-height: 100%;
		max-width: 100%;
		border: 0;
		outline: 0;
		margin: 0;
	}

	body {
		background-color: #181818;
		color: #f0f0f0;
		display: flex;
		flex-direction: row;
	}

	video, canvas, img {
		border-style: solid;
		border-width: 1px;
	}

	.left, .right {
		padding: 0.5em;
	}

	.left {
		display: flex;
		flex: 0.7;
		height: 100%;
		flex-direction: column;
		overflow-y: auto;
	}

	.right {
		background-color: #191919;
		display: flex;
		flex: 0.3;
		height: 100%;
		flex-direction: column;
		overflow-y: auto;
	}

	.right .button, .right .slider, .right .title, video, canvas, img {
		width: 100%;
		padding: 0.5em;
	}

	.right .rows {
		width: 100%;
		display: flex;
		flex-direction: row;
	}

	.right .button {
		flex: 0.5;
		background-color: #191919;
		color: #c0c0c0;
		margin: 0.5em;
		border-bottom-style: solid;
		border-bottom-width: 3.5px;
		border-bottom-color: #a00000;
		box-shadow: 0 10px 10px rgba(0,0,0,0.22);
		transform: none;
	}

	.right .button:hover, .right .button:focus {
		background-color: #222222;
		color: #f0f0f0;
		border-bottom-color: #f00000;
	}

	.right .button:active {
		animation-name: press;
	}

	.right .title {
		background-color: #d00000;
	}

	.right .title:hover {
		background-color: #e00000;
		color: #303030;
	}

	.right .slider {
		flex: 1 1;
	}
</style>
</head>
<body>
	<div class="left">
		<video id="webcam" autoplay="true" loop="true"></video>
		<canvas id="parser"></canvas>
		<canvas id="result"></canvas>
	</div>
	<div class="right">
		<div class="title">Projeto-Video</div>
		<div class="rows"></div>
	</div>
</body>
<script src="/editor.js"></script>
<script src="/util.js"></script>
<script>
	const LeftContainer = document.querySelector(".left");
	const RightContainer = document.querySelector(".right");
	const RowsContainer = RightContainer.querySelector(".rows");

	const video = LeftContainer.querySelector("#webcam");
	const image = LeftContainer.querySelector("#picture");
	const canvas1 = LeftContainer.querySelector("#parser");
	const canvas2 = LeftContainer.querySelector("#result");

    Util.setContainer(RowsContainer);

	function getRGB(frame, i) {
		return [frame[i], frame[i + 1], frame[i + 2]];
	}

	function getD(rgb, r, g, b) {
		return Math.max(
			Math.abs(rgb[0] - r),
			Math.abs(rgb[1] - g),
			Math.abs(rgb[2] - b)
		);
	}

	function equation(editor, i, x, y, r, g, b, a) {
		var diff = [255, 255, 255, 255];
		var equal = [0, 0, 0, 255];

		if (y > 0) {
			if (getD(getRGB(editor.frame, i - 4), r, g, b) > t) {
				return equal
			}
		}
		if (y < editor.realWidth) {
			if (getD(getRGB(editor.frame, i + 4), r, g, b) > t) {
				return equal
			}
		}
		if (x > 0) {
			if (getD(getRGB(editor.frame, i - editor.realWidth), r, g, b) > t) {
				return equal
			}
		}
		if (x < editor.length) {
			if (getD(getRGB(editor.frame, i + editor.realWidth), r, g, b) > t) {
				return equal
			}
		}

		return diff;
	}

	Util.Button("f", "Frontal Camera", function() {
		navigator.getUserMedia({video: true, audio: false},
		function(stream) {
			video.srcObject = stream;
			// video.onplay = function() {
			// 	var editor = new Editor(video, video.videoWidth, video.videoHeight, canvas1, canvas2);

			// 	Util.Button("i", "info", function() {
			// 		console.log(stream);
			// 		var track = stream.getVideoTracks()[0];
			// 		console.log(track);
			// 		var cap = track.getCapabilities();
			// 		console.log(JSON.stringify(cap));
			// 	});

			// 	Util.loop(function() {
			// 		editor.draw();
			// 	});
			// }
		}, function() {console.log("Error on Video")});
	});

	Util.Button("b", "Back Camera", function() {
		navigator.getUserMedia({video: {facingMode: "environment"}, audio: false},
		function(stream) {
			video.srcObject = stream;
			video.onplay = function() {
				var editor = new Editor(video, video.videoWidth, video.videoHeight, canvas1, canvas2);

				Util.Button("i", "info", function() {
					console.log(stream);
					var track = stream.getVideoTracks()[0];
					console.log(track);
					var cap = track.getCapabilities();
					console.log(JSON.stringify(cap));
				});

				Util.loop(function() {
					editor.draw();
				});
			}
		}, function() {console.log("Error on Video")});
	});
</script>
</html>
